/**
 * Image to PDF Converter
 * Author: A.I Raju
 * Date: 04-03-2025
 * Description: Convert multiple images to a single PDF file using jsPDF library
 * Dependencies: jsPDF (
 *   https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js
 * )
 */
window.jsPDF=window.jspdf.jsPDF;let uploadedFiles=[];const SUPPORTED_TYPES=["image/jpeg","image/png","image/gif","image/bmp","image/webp"],MAX_FILE_SIZE=15728640,toastContainer=document.createElement("div");function showToast(e,t="danger"){const n="toast-"+Date.now(),a=`\n    <div id="${n}" class="toast border-0 shadow-sm" role="alert" aria-live="assertive" aria-atomic="true">\n        <div class="toast-header bg-${t} text-white">\n        <strong class="me-auto">Notification</strong>\n        <button type="button" class="btn-close bg-light" data-bs-dismiss="toast" aria-label="Close"></button>\n        </div>\n        <div class="toast-body bg-white text-${t}">\n        ${e}\n        </div>\n    </div>\n    `;toastContainer.insertAdjacentHTML("beforeend",a);const s=document.getElementById(n);new bootstrap.Toast(s,{autohide:!0,delay:3e3}).show(),s.addEventListener("hidden.bs.toast",(()=>s.remove()))}function handleFileSelect(e){const t=e.target.files;t.length>50?showToast("You can convert 50 images at once!"):handleFiles(t)}function handleDrop(e){e.preventDefault();handleFiles(e.dataTransfer.files)}function validateFile(e){return SUPPORTED_TYPES.includes(e.type)?e.size>15728640?`File "${e.name}" exceeds maximum size of 15MB`:null:`File "${e.name}" is not a supported image type. Supported types: JPG, PNG, GIF, BMP`}function handleFiles(e){const t=[];uploadedFiles=Array.from(e).filter((e=>{const n=validateFile(e);return!n||(t.push(n),!1)})),t.length>0&&t.forEach((e=>showToast(e)));document.getElementById("imagePreview").innerHTML=`\n        <div class="text-left mt-4 mb-3 bg-light p-3 rounded-3 shadow-sm border">\n            <h3 class="fs-5 fw-bold d-block">Selected <span id="previewImgCount">${uploadedFiles.length}</span> images</h3>\n            <div id="previewImageItems" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-auto g-3 m-auto justify-content-center mt-2"></div>\n        </div>\n    `;const n=document.getElementById("previewImageItems");uploadedFiles.forEach((e=>{const t=new FileReader;t.onload=t=>{const a=document.createElement("div");a.className="col",a.innerHTML=`\n            <div class="imagePreviewCard bg-white shadow-sm">\n                <img src="${t.target.result}" class="img-fluid preview-image" />\n                <div class="file_info p-2">\n                    <small class="d-block">${e.name}</small>\n                    <small class="text-secondary">${e.type.split("/")[1].toUpperCase()} â€¢ ${(e.size/1024).toFixed()} KB</small>\n                    <span class="float-end mt-2 text-danger" tabindex="0" onclick="this.closest('.col').remove();removeImg('${e.name}')"><i class="bi bi-x"></i> Remove</span>\n                </div>\n            <div>\n        `,n.appendChild(a)},t.readAsDataURL(e)}))}function removeImg(e){uploadedFiles=uploadedFiles.filter((t=>t.name!==e)),0===uploadedFiles.length&&(document.getElementById("imagePreview").innerHTML=""),document.getElementById("previewImgCount").innerText=uploadedFiles.length}async function convertToPDF(){if(0===uploadedFiles.length)return void showToast("Please select at least one image");var e=document.getElementById("convertBtn"),t=document.getElementById("downloadPDFContainer"),n=document.getElementById("previewImageItems"),a=document.getElementById("resetBtn");e.disabled=!0,a.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Converting...',showToast('<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Converting images to PDF, please wait...',"primary"),n.style.opacity=.5;const s=createProgressBar(),o=document.getElementById("pageSize").value,i=document.getElementById("orientation").value,d=new jsPDF(i,"mm",o);try{for(let e=0;e<uploadedFiles.length;e++){e>0&&d.addPage();const t=await loadImage(uploadedFiles[e]),n=d.getImageProperties(t),a=d.internal.pageSize.getWidth(),o=d.internal.pageSize.getHeight(),i=Math.min(a/n.width,o/n.height),r=n.width*i,l=n.height*i,c=(a-r)/2,m=(o-l)/2;d.addImage(t,"JPEG",c,m,r,l),updateProgress(s,(e+1)/uploadedFiles.length*100)}const o=d.output("blob"),i=URL.createObjectURL(o),r=document.getElementById("downloadPDF");r.href=i,r.classList.remove("d-none"),t.classList.remove("d-none"),r.setAttribute("download",`combined_images_${(new Date).getTime()}.pdf`),r.innerHTML='<i class="bi bi-file-earmark-pdf-fill"></i> Download PDF',r.addEventListener("click",(()=>{t.classList.add("d-none"),r.classList.add("d-none"),URL.revokeObjectURL(i)})),removeProgressBar(s),n.style.opacity=1,e.innerHTML='<i class="bi bi-filetype-pdf"></i> Convert to PDF',e.disabled=!1,a.disabled=!1,showToast('<i class="bi bi-check-circle-fill me-2"></i> Conversion completed successfully',"success")}catch(t){console.error("Conversion error:",t),showToast("Error during conversion: "+t.message),e.innerHTML='<i class="bi bi-filetype-pdf"></i> Convert to PDF',removeProgressBar(s),e.disabled=!1,n.style.opacity=1}}function createProgressBar(){const e=document.createElement("div");return e.className="progress mt-3",e.innerHTML='\n        <div class="progress-bar" role="progressbar" style="width: 0%" \n             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>\n    ',document.querySelector("#progress").appendChild(e),e}function updateProgress(e,t){const n=e.querySelector(".progress-bar");n.style.width=`${t}%`,n.setAttribute("aria-valuenow",t),n.innerText=`${t.toFixed()}%`}function removeProgressBar(e){setTimeout((()=>e.remove()),1e3)}function loadImage(e){return new Promise(((t,n)=>{const a=new FileReader;a.onload=e=>t(e.target.result),a.onerror=n,a.readAsDataURL(e)}))}toastContainer.className="toast-container position-fixed top-0 end-0 p-3",document.body.appendChild(toastContainer),document.getElementById("fileInput").addEventListener("change",handleFileSelect),document.getElementById("dropZone").addEventListener("dragover",(e=>e.preventDefault())),document.getElementById("dropZone").addEventListener("drop",handleDrop),document.getElementById("convertBtn").addEventListener("click",convertToPDF),document.getElementById("resetBtn").addEventListener("click",(()=>{document.getElementById("imagePreview").innerHTML="",uploadedFiles=[],document.getElementById("fileInput").value="",downloadPDFContainer.classList.add("d-none")}));